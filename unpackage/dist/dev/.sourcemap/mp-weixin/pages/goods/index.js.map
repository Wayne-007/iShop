{"version":3,"file":"index.js","sources":["pages/goods/index.vue","pages/goods/index.vue?type=page"],"sourcesContent":["<template>\r\n\t<view class=\"goods\">\r\n\t\t<!-- <view class=\"search-box\">\r\n\t\t\t<uni-easyinput clearable suffixIcon=\"search\" confirmType=\"search\" trim=\"both\" v-model=\"searchVal\"\r\n\t\t\t\tplaceholder=\"请输入商品名称\" @iconClick=\"getGoodList\" @clear=\"handleClear\" @confirm=\"getGoodList\" />\r\n\t\t</view> -->\r\n\t\t<!-- <view class=\"goods-list-box\"> -->\r\n\t\t<GoodsList :goodsList=\"goodsList\" :isEnd=\"isEnd\" />\r\n\t\t<!-- </view> -->\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport GoodsList from '../../components/goodsList/index.vue'\r\n\timport UniEasyinput from '../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.vue'\r\n\timport {\r\n\t\tref,\r\n\t\tgetCurrentInstance,\r\n\t\tonMounted,\r\n\t\treactive\r\n\t} from 'vue'\r\n\timport {\r\n\t\tonReachBottom,\r\n\t\tonPullDownRefresh\r\n\t} from '@dcloudio/uni-app'\r\n\r\n\tconst {\r\n\t\tproxy\r\n\t} = getCurrentInstance()\r\n\r\n\t// 页码相关\r\n\tconst pageInfo = reactive({\r\n\t\tpagenum: 1,\r\n\t\tpagesize: 20\r\n\t})\r\n\r\n\t// 搜索的内容\r\n\tconst searchVal = ref(undefined)\r\n\tconst handleClear = () => {\r\n\t\tsearchVal.value = undefined\r\n\t\tpageInfo.pagenum = 1\r\n\t\tgetGoodList()\r\n\t}\r\n\r\n\tconst goodsList = ref([])\r\n\tconst total = ref(0)\r\n\tconst getGoodList = (callback) => {\r\n\r\n\t\tconst _data = {\r\n\t\t\t...pageInfo\r\n\t\t}\r\n\t\tif (searchVal.value) {\r\n\t\t\t_data.query = searchVal.value\r\n\t\t}\r\n\t\tproxy.$request({\r\n\t\t\turl: '/api/public/v1/goods/search',\r\n\t\t\tdata: _data\r\n\t\t}).then(res => {\r\n\t\t\tconsole.log(res)\r\n\t\t\ttotal.value = res.total || 0\r\n\t\t\tconst _goods = res.goods || []\r\n\t\t\tif (pageInfo.pagenum === 1) {\r\n\t\t\t\tgoodsList.value = _goods\r\n\t\t\t} else if (pageInfo.pagenum > 1) {\r\n\t\t\t\tgoodsList.value = goodsList.value.concat(_goods)\r\n\t\t\t}\r\n\t\t}).catch(err => {\r\n\t\t\tgoodsList.value = []\r\n\t\t\ttotal.value = 0\r\n\t\t}).finally(() => {\r\n\t\t\tcallback && callback()\r\n\t\t})\r\n\t}\r\n\r\n\tonMounted(() => {\r\n\t\tgetGoodList()\r\n\t})\r\n\r\n\t// 监听用户下拉刷新\r\n\tlet timeout = undefined\r\n\tonPullDownRefresh(() => {\r\n\t\t// 下拉刷新好像在h5无效\r\n\t\tconsole.log('onPullDownRefresh===>')\r\n\r\n\t\tpageInfo.pagenum = 1\r\n\t\tgoodsList.value = []\r\n\t\tif (timeout) {\r\n\t\t\tclearTimeout(timeout)\r\n\t\t}\r\n\t\ttimeout = setTimeout(() => {\r\n\t\t\tgetGoodList(() => {\r\n\t\t\t\tuni.stopPullDownRefresh()\r\n\t\t\t})\r\n\t\t}, 800)\r\n\t})\r\n\r\n\t// 监听页面滚动到底加载下一页\r\n\tconst isEnd = ref(false)\r\n\tonReachBottom(() => {\r\n\t\tif (total.value < pageInfo.pagenum * pageInfo.pagesize) {\r\n\t\t\tisEnd.value = true\r\n\t\t\treturn\r\n\t\t}\r\n\t\tisEnd.value = false\r\n\t\tpageInfo.pagenum += 1\r\n\t\tgetGoodList()\r\n\t})\r\n</script>\r\n\r\n<style lang=\"less\">\r\n\t.goods {\r\n\t\twidth: 750rpx;\r\n\t\t// height: calc(100vh - 2rpx - 44px);\r\n\t\t// display: flex;\r\n\t\t// flex-direction: column;\r\n\t\tbackground-color: #cecece;\r\n\t\tscrollbar-width: none;\r\n\t\t/* Firefox */\r\n\t\t-ms-overflow-style: none;\r\n\t\t/* IE and Edge */\r\n\r\n\t\t/* WebKit浏览器 */\r\n\t\t&::-webkit-scrollbar {\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t// .search-box {\r\n\t\t// \twidth: 750rpx;\r\n\t\t// \theight: 96rpx;\r\n\t\t// \tpadding: 16rpx;\r\n\t\t// \tbox-sizing: border-box;\r\n\t\t// \tborder-bottom: 2rpx solid #cecece;\r\n\t\t// }\r\n\r\n\t\t// .goods-list-box {\r\n\t\t// \tflex: 1;\r\n\t\t// \toverflow-x: hidden;\r\n\t\t// \toverflow-y: auto;\r\n\t\t// \tscrollbar-width: none;\r\n\t\t// \t/* Firefox */\r\n\t\t// \t-ms-overflow-style: none;\r\n\t\t// \t/* IE and Edge */\r\n\r\n\t\t// \t/* WebKit浏览器 */\r\n\t\t// \t&::-webkit-scrollbar {\r\n\t\t// \t\tdisplay: none;\r\n\t\t// \t}\r\n\t\t// }\r\n\t}\r\n</style>","import MiniProgramPage from '/Users/wayne/Documents/MyProject/iShop/pages/goods/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","reactive","ref","uni","onMounted","onPullDownRefresh","onReachBottom","MiniProgramPage"],"mappings":";;;;;AAaC,MAAM,YAAY,MAAW;;;;AAa7B,UAAM;AAAA,MACL;AAAA,IACA,IAAGA,iCAAoB;AAGxB,UAAM,WAAWC,cAAAA,SAAS;AAAA,MACzB,SAAS;AAAA,MACT,UAAU;AAAA,IACZ,CAAE;AAGD,UAAM,YAAYC,cAAG,IAAC,MAAS;AAO/B,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,QAAQA,cAAG,IAAC,CAAC;AACnB,UAAM,cAAc,CAAC,aAAa;AAEjC,YAAM,QAAQ;AAAA,QACb,GAAG;AAAA,MACH;AACD,UAAI,UAAU,OAAO;AACpB,cAAM,QAAQ,UAAU;AAAA,MACxB;AACD,YAAM,SAAS;AAAA,QACd,KAAK;AAAA,QACL,MAAM;AAAA,MACT,CAAG,EAAE,KAAK,SAAO;AACdC,sBAAAA,MAAA,MAAA,OAAA,+BAAY,GAAG;AACf,cAAM,QAAQ,IAAI,SAAS;AAC3B,cAAM,SAAS,IAAI,SAAS,CAAE;AAC9B,YAAI,SAAS,YAAY,GAAG;AAC3B,oBAAU,QAAQ;AAAA,QACtB,WAAc,SAAS,UAAU,GAAG;AAChC,oBAAU,QAAQ,UAAU,MAAM,OAAO,MAAM;AAAA,QAC/C;AAAA,MACJ,CAAG,EAAE,MAAM,SAAO;AACf,kBAAU,QAAQ,CAAE;AACpB,cAAM,QAAQ;AAAA,MACjB,CAAG,EAAE,QAAQ,MAAM;AAChB,oBAAY,SAAU;AAAA,MACzB,CAAG;AAAA,IACD;AAEDC,kBAAAA,UAAU,MAAM;AACf,kBAAa;AAAA,IACf,CAAE;AAGD,QAAI,UAAU;AACdC,kBAAAA,kBAAkB,MAAM;AAEvBF,oBAAAA,MAAY,MAAA,OAAA,+BAAA,uBAAuB;AAEnC,eAAS,UAAU;AACnB,gBAAU,QAAQ,CAAE;AACpB,UAAI,SAAS;AACZ,qBAAa,OAAO;AAAA,MACpB;AACD,gBAAU,WAAW,MAAM;AAC1B,oBAAY,MAAM;AACjBA,wBAAAA,MAAI,oBAAqB;AAAA,QAC7B,CAAI;AAAA,MACD,GAAE,GAAG;AAAA,IACR,CAAE;AAGD,UAAM,QAAQD,cAAG,IAAC,KAAK;AACvBI,kBAAAA,cAAc,MAAM;AACnB,UAAI,MAAM,QAAQ,SAAS,UAAU,SAAS,UAAU;AACvD,cAAM,QAAQ;AACd;AAAA,MACA;AACD,YAAM,QAAQ;AACd,eAAS,WAAW;AACpB,kBAAa;AAAA,IACf,CAAE;;;;;;;;;;;ACzGF,GAAG,WAAWC,SAAe;"}